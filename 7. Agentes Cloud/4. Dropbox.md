## Visión general y rutas clave

* **Perfil de app y DBs (Windows):** `%UserProfile%\AppData\Local\Dropbox\` → subcarpeta `instance<#>` suele contener las **DBs primarias** (si faltan puede indicar desinstalación). En versiones antiguas algunas DBs residían en **Roaming**.
* **Carpeta sincronizada (por defecto):** `%UserProfile%\Dropbox` (configurable). **Caché oculta:** `%UserProfile%\Dropbox\.dropbox.cache` (puede conservar temporales, incluidos **eliminados** o **solo nube**; se purga **cada 3 días**).
* **Ruta sincronizada real (confirmación):** `info.json` (más abajo) y la clave de registro
  `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\SyncRootManager\Dropbox!<SID>!Personal\UserSyncRoots`.
* **Retención de eliminados en la nube:** 30 días (Basic/Plus) y **120 días** (Business); los admins pueden desactivar el borrado permanente.
	* **Contexto histórico:** muchas DBs de Dropbox -  estado cifradas con **DPAPI** (p.ej., `filecache.dbx`, hoy obsoleta). En versiones modernas existe **más dato en claro** en varias DBs.

## Ficheros/DBs principales y qué aportan

* **`info.json`** — `%UserProfile%\AppData\Local\Dropbox\`
  Claves útiles: `path` (raíz local), `is_team` (equipo), `subscription_type` (Business/Enterprise ⇒ **auditoría mejorada** en la nube).
* **`aggregation.dbx`** — `…\Dropbox\instance<#>\` (SQLite)
  Tabla `snapshot` → **par** `recent` (JSON masivo): **ruta** relativa, **epoch** de última actualización y **atribución** limitada (`edited_by_me`). Puede abarcar un periodo amplio, no solo “lo reciente”.
* **`home.db`** — `…\instance<#>\` (SQLite)
	- `recents`: `server_path`, `timestamp` (epoch).
	- `starred_items`: `server_path`, `is_starred`, `timestamp`.
	- `sfj_resources`: `server_path`, `name`, `server_fetch_timestamp` (epoch, **no** generado por el usuario).
* **`sync_history.db`** — `…\instance<#>\` (SQLite)
  `file_event_type` (add/delete/edit), `direction` (Upload/Download), `local_path`, `timestamp` (epoch), `other_user` (“1” si el propietario original **difiere** del de la cuenta). Suele abarcar **meses**.
* **`nucleus.sqlite3`** — `…\instance<#>\sync\` (SQLite)
  Catálogo de **nombres** locales y nube:
  `local_tree` / `synced_tree` (presentes localmente) y `remote_tree` (propiedad del usuario, **incluye solo nube**). Los **nombres** están en **BLOBs hex** que contienen ASCII.
* **`icon.db`** — `…\instance<#>\` (SQLite)
  `path_icon_table`: `file_path` (ruta completa; añade sufijo de tamaño), `created_time` (epoch; indica **existencia** previa del fichero).
* **`tray-thumbnails.db`** — `…\machine_storage\` (SQLite)
  `cached_thumbnail_table`: `file_name` (imagen), `timestamp` (creación miniatura ⇒ evidencia de **presencia en Dropbox**, incluso si fue eliminado).
* **`.dropbox.cache`** — en la raíz de la carpeta sincronizada; puede contener **copias** y staging de subidas/descargas; purga automática cada **3 días**.

## Auditoría en la nube (Eventos Dropbox)

* **Todos los planes:** página **Eventos** (limitada). **Business (Avanzado):** **registro detallado** por usuario/archivo (añadir, descargar, editar, mover, renombrar, eliminar; compartición interna/externa), exportable a **CSV**, con **IP** y filtros (demora de publicación hasta **24 h**).
* **Limitación importante:** IPs de **usuarios externos** pueden aparecer **ofuscadas**/genéricas en CSV (p. ej., 69.119.x.x, 34.86.x.x), dificultando atribución.

## Evidencias de ejecución en el endpoint

* **Eventos de Aplicación:** `Application.evtx` → **Event ID 1040** (“Beginning a Windows Installer transaction”).
* **Prefetch:** `C:\Windows\Prefetch\DROPBOX.EXE-XXXXXXXX.pf`.
* **LNK:** acceso directo al binario `C:\Program Files (x86)\Dropbox\Client\Dropbox.exe`.

## Artefactos de navegación y del SO

* Revisar historiales/DBs de navegador para **creación**, **descarga**, **edición** (URLs y endpoints de Dropbox Web).
* Correlacionar con artefactos de Windows: **LNK/Jump Lists, RecentDocs, Office MRUs, ShellBags, Prefetch, Papelera** (incluye nubes “virtuales” y carpetas de eliminados online).

## Alternate Data Streams (ADS) de Dropbox

* Los archivos en la carpeta sincronizada llevan **ADS** (p.ej., `com.dropbox.attributes` / `com.dropbox.attrs`). Permiten **rastrear** que un fichero **estuvo** en Dropbox; el **ADS persiste** si el archivo se copia entre volúmenes NTFS. El **header** de `com.dropbox.attributes` puede revelar el **ID** de la máquina.

---

## Procedimiento sugerido de análisis (checklist)

1. **Localiza y documenta configuración:** extrae `info.json` (path local, plan, equipo) y la clave **SyncRootManager**; confirma presencia de `instance<#>`.
2. **Enumera metadatos por DB:**
	- `home.db` (`recents`, `starred_items`, `sfj_resources`).
	- `aggregation.dbx` (`snapshot.recent` JSON con rutas/epoch/atribución).
	- `sync_history.db` (tipo de evento, dirección, `local_path`, epoch, `other_user`).
	- `nucleus.sqlite3` (`local_tree`, `synced_tree`, `remote_tree` → **nombres** en BLOBs).
3. **Busca contenido “recuperable”:** `tray-thumbnails.db` (imágenes vistas, incluso **eliminadas**); `.dropbox.cache` (staging/temporales); Shadow Copies de `%UserProfile%\Dropbox`.
4. **Correlación temporal:** convierte **epoch (UTC)** de todas las tablas y alinea con Prefetch/LNK/Jump Lists/Office MRUs.
5. **Auditoría en la nube (si Business):** exporta **CSV** y filtra por usuario/acción/archivo/IP; ten en cuenta la **ofuscación** de IPs externas y el **retardo** de \~24 h.
6. **ADS:** si el archivo se halló fuera de la carpeta de Dropbox, revisa ADS `com.dropbox.*` para probar su **origen**.
7. **Notas DPAPI:** si faltan DBs modernas, recuerda que algunas **antiguas** (p.ej., `filecache.dbx`) requerían **credenciales** para descifrado.

---

## Tabla rápida “Qué buscar / Dónde / Para qué”

| Qué                         | Dónde                                                                             | Para qué                                                                                                                         |
| --------------------------- | --------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| Ruta real sincronizada      | `info.json` + `SyncRootManager\Dropbox!...UserSyncRoots`                          | Ubicar raíz local actual y confirmar estado de sincronización.                                                                   |
| Recientes / Estrellas / SFJ | `home.db`                                                                         | Actividad reciente (rutas y tiempos), marcados, última actualización desde servidor.                                             |
| Historial de sync           | `sync_history.db`                                                                 | **Qué pasó** (add/delete/edit), **dirección** (Up/Down), **ruta completa**, **epoch**, y si el cambio vino de **otro usuario**.  |
| Catálogo (local/nube)       | `nucleus.sqlite3` (`local/synced/remote_tree`)                                    | Listar nombres presentes localmente y **solo en la nube** (decodificar BLOB→ASCII).                                              |
| JSON de cambios históricos  | `aggregation.dbx` (`snapshot.recent`)                                             | Rutas y **última actualización** (epoch) + `edited_by_me` (atribución básica).                                                   |
| Miniaturas de bandeja       | `machine_storage\tray-thumbnails.db`                                              | Evidenciar **existencia** de imágenes (incluidas eliminadas) mediante nombre + timestamp.                                        |
| Caché local                 | `.dropbox.cache`                                                                  | Copias temporales (incl. eliminados/solo nube), purga **3 días**.                                                                |
| Ejecución de la app         | `Application.evtx` (ID 1040), **Prefetch** `DROPBOX.EXE-*.pf`, **LNK** al binario | Demostrar instalación/uso en endpoint.                                                                                           |
| Auditoría nube              | Página “Eventos” / CSV Business                                                   | Trazabilidad ampliada (archivos/compartición/IP), con **ofuscación** en IPs externas.                                            |
| ADS Dropbox                 | `com.dropbox.attributes` / `com.dropbox.attrs`                                    | Probar que un **archivo** pasó por Dropbox (persiste entre volúmenes NTFS).                                                      |

---

### Notas y “gotchas”

* **Epoch/UTC:** convierte siempre a zona horaria del caso antes de correlacionar. Muchas tablas usan **Unix epoch**.
* **No todo está en una sola DB:** la **reconstrucción** exige sumar `home.db` + `sync_history.db` + `nucleus.sqlite3` + `aggregation.dbx` + `tray-thumbnails.db`.
* **IPs externas en CSV:** la **ofuscación** puede esconder justo el acceso que buscas (no-empleados). Documenta la limitación.
* **DPAPI (legacy):** si trabajas con clientes antiguos, planifica **credenciales** para descifrado (p.ej., `filecache.dbx`).