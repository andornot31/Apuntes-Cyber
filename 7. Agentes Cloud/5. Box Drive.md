# Apuntes (resumidos pero completos) — Módulo 7 · Box Drive

## Visión general

* **Box Drive** usa un **sistema de archivos virtual** (punto de reparación NTFS) montado por defecto bajo `%UserProfile%\Box`. El árbol “Box” puede verse **vacío en imágenes frías** (C:) o **desaparecer** si el usuario cerró sesión o la app no está corriendo.
* Es, de entre los clientes tratados, el **más “forensic-friendly”**: registros locales detallados y **SQLite** con nombres, tamaños, marcas de tiempo y **SHA-1** tanto de archivos **en caché** como **solo en la nube**.
* **No confundir con Box Sync** (legacy): Box Drive suele **desinstalarla** al instalarse.

## Rutas y artefactos clave

* **Carpeta virtual del usuario**: `%UserProfile%\Box` (reparse → volumen virtual de caché). Para localizar la ruta si cambió, busca `logDriveInformation` en los logs.
* **Metadatos y logs**:
	- DBs y logs: `%UserProfile%\AppData\Local\Box\Box\` → **`data`** (DBs), **`logs`** (incluye **Box\_Streem**), **`cache`** (contenido).
	- Si la app no está en ejecución, la carpeta virtual puede **no existir** a nivel de disco.

## Bases de datos principales (SQLite)

### a) `sync.db` — inventario “local + nube”

Ubicación: `…\Box\Box\data\sync.db`. Tablas clave:

* **`box_item`** → `parent_item_id` (carpeta padre), `name`, `checksum` (**SHA-1**), `size`, `content_created_at`, `content_updated_at` (epoch). **Ojo**: al interactuar **vía web**, estas marcas pueden **no actualizarse** como esperas; vía **Explorer** sí.
* **`local_item`** → `inode` (ID universal para correlación rápida con **streemsfs.db**).

### b) `streemsfs.db` — **qué está en caché** y dónde

* Sigue elementos guardados en caché (acceso desde nube o marcados **offline** a nivel de **carpeta**). La **caché** puede crecer hasta **25 GB o ½ del disco** (lo menor).
* Tablas:
	- **`fsnodes`** → `name`, `createdAtTimestamp`, `modifiedAtTimestamp`, `accessedAtTimestamp` (se actualiza al abrir desde la carpeta local), `inodeId`, `parentInodeId`, `markForOffline`, `folderFetchTimestamp`.
	- **`cachefiles`** → `cacheDataId` (nombre del fichero **en** `…\cache`), `size`, `inodeId`, `age` (**0** ⇒ aún **no** cacheado). El fichero real está en `…\Box\Box\cache\` con nombre = `cacheDataId`.
* **Herramienta**: **streemBOXlite** (Python3) parsea `streemsfs.db` y saca **CSV/JSON** mapeando **nombre original ↔ cacheDataId**.

### c) `metrics.db`

* `aggregated_metrics.payload` suele contener el **login/email** usado para autenticarse.

## Logs de uso — **Box\_Streem**

* Carpeta: `…\Box\Box\logs\` → `Box_Streem_#_<date>.log`. Registra **add/update/delete/open** y, a menudo, **la aplicación** que abrió el fichero (p.ej., `AcroRd32.exe`). Útiles etiquetas: **`[onDeleteFile]`**, **`[addFile]`**, **`[onOpenFile]`**, y en altas locales verás `serializeAndSendFile`. Pueden pesar **cientos de MB** y cubrir **semanas**.

## Auditoría en la nube (empresas)

* Para auditoría corporativa, además de Box\_Streem locales, las cuentas **Enterprise** disponen del **Enterprise Event Log** (API).

## Tiempos de archivo (FS) — cómo se comporta Box Drive

* **Modificación**: se **preserva** al sincronizar entre dispositivos.
* **Creación**: normalmente se **pone a la hora de sincronización** (no la original; excepción: **Box Backup & Sync**, no **Box Drive**).
* **Acceso**: Box Drive **actualiza** el *atime* al abrir desde la carpeta local, aunque ese atime no siempre se **propaga** entre dispositivos.

---

## Procedimiento sugerido (checklist)

1. **Confirmar raíz y sesión**
	- Ver si existe `%UserProfile%\Box`; si no, puede ser porque la app no corre o no hay sesión. Revisa `Box_Streem` buscando `logDriveInformation` para la **ruta real**.
2. **Inventariar metadatos (local+nube)**
	- Extrae `sync.db` → `box_item` (nombres, **SHA-1**, tamaños, tiempos, jerarquías) y `local_item` (`inode`).
3. **Determinar qué hay en caché (recuperable)**
	- Cruza `streemsfs.db` (`fsnodes`/`cachefiles`) y recobra en `…\cache\` por `cacheDataId`. Marca si es **offline** y cuándo se “fetch-eó” la carpeta.
	- Si hay muchos elementos, usa **streemBOXlite** para exportar CSV/JSON.
4. **Trazar uso**
	- Filtra **Box\_Streem** por ruta/ID/acción; correlaciona con `accessedAtTimestamp` de `streemsfs.db`.
5. **Correlación SO/Navegador**
	- LNK/Jump Lists/RecentDocs/Office MRUs, Papelera, Shadow Copies, e historial de navegador con términos “**Box**”/“**Drive**”.
6. **(Empresa)** Exporta **Enterprise Event Log** por API si necesitas trazabilidad adicional.

---

## Tabla rápida “Qué buscar / Dónde / Para qué”

| Qué                                        | Dónde                                                      | Para qué                                                                                            |
| ------------------------------------------ | ---------------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| Raíz “Box” y estado                        | `%UserProfile%\Box` (reparse) + logs `logDriveInformation` | Ver si hay sesión/cliente activo y localizar la **ruta real**.                                      |
| **sync.db** (`box_item`, `local_item`)     | `…\AppData\Local\Box\Box\data\`                            | Inventario **local+nube**, **SHA-1**, tamaños, tiempos, y `inode` para correlación.                 |
| **streemsfs.db** (`fsnodes`, `cachefiles`) | `…\data\`                                                  | Saber **qué está en caché**, **dónde** (por `cacheDataId`) y si está **offline**; límites de caché. |
| Carpeta **cache**                          | `…\Box\Box\cache\`                                         | Recuperar el **fichero real** (nombre = `cacheDataId`).                                             |
| **Box\_Streem** logs                       | `…\Box\Box\logs\`                                          | Trazar **add/update/delete/open** y app que abrió el archivo.                                       |
| Cuenta (login/email)                       | `metrics.db` → `aggregated_metrics.payload`                | Atribución de usuario autenticado.                                                                  |
| Auditoría (empresa)                        | **Enterprise Event Log** (API)                             | Registro corporativo complementario.                                                                |

---

## Notas y *gotchas*

* **Adquisición**: la carpeta `%UserProfile%\Box` puede verse **vacía** en imágenes; para contenido, usa **`streemsfs.db` + cache** y/o adquiere **en vivo**.
* **Web vs Explorer**: si la interacción fue **web**, las timestamps de DB pueden **no reflejar** accesos/actualizaciones esperadas. Valida con logs **Box\_Streem**.
* **Timestamps FS**: Box Drive **actualiza atime** al abrir; **creation time** suele ser **hora de sincronización**, no la original. Documenta estas diferencias.
* **Caché grande**: hasta **25 GB** o ½ del disco; prioriza por **ruta** y **hash**.
* **KAPE**: existen **targets** específicos para Box (metadatos/archivos) que agilizan la recogida.