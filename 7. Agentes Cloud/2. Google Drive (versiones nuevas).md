## Visión general

* La app actual es **Google Drive para escritorio (DriveFS)**: unificó el antiguo **Google File Stream** (empresas) y **Backup and Sync** (consumidores).
* Implementa **acceso bajo demanda** mediante un **sistema de archivos virtual** propio: monta una **unidad FAT32 virtual** con letra de unidad y expone “**Mi unidad**” solo en sistemas **vivos** con el usuario autenticado.
* El montaje y la cuenta asociada se reflejan en el Registro: `NTUSER\Software\Google\DriveFS\Share` → valor **SyncTargets** (letra de unidad y **ID de cuenta** en hex). En File Stream antiguo aparecía como `MountPoint`.

## Rutas y artefactos clave (DriveFS)

* **Metadatos locales**:
  `%UserProfile%\AppData\Local\Google\DriveFS\<account_id>\`

  * `<account_id>` = identificador de **cuenta de Google** (antes: *email* en **base64**).
  * **Base principal**: `metadata_sqlite_db` (incluye **offline**, **solo nube**, **Compartidos conmigo** y **Papelera**). Tabla **items** (id, stable\_id, local\_title, is\_owner, trashed, is\_folder, tamaños, marcas de tiempo). Puede existir **mirror\_metadata\_sqlite\_db** con datos duplicados.
* **Caché de contenido**:
  `%UserProfile%\AppData\Local\Google\DriveFS\<account_id>\content_cache`
  Archivos **renombrados sin extensión**, pero **contenido intacto** (identificables por **cabecera** o **hash**). Útil para recuperar copias de archivos **solo nube** si no es posible el análisis en vivo.

## Comportamiento de marcas de tiempo

* En **Google Drive para escritorio**, la **hora de creación** del archivo se **conserva entre dispositivos**; también se actualiza el **último acceso** al abrir (aunque difiere del estándar de FS).
* Comparativa de sincronización: la **modificación** se preserva en todas; Drive Desktop preserva además **creación** y **acceso** (ver tabla del módulo).

## Auditoría en Google Workspace (empresas)

* **Registro de auditoría de Drive** (consola de administración): registra **visto/creado/previsualizado/modificado/eliminado/descargado/compartido**, incluyendo Docs/Sheets/Slides y ficheros subidos (PDF, DOCX…). **Ojo**: algunas acciones generan **eventos redundantes** (p. ej., “Descarga” al previsualizar). Filtrado flexible y exportable para análisis; las **IPs** ayudan a discriminar actores, pero no siempre son filtro nativo de la UI.
* **Cruces útiles**: `items.id` de `metadata_sqlite_db` ↔ **ID de archivo** en registros/URLs del navegador para atribución fina y reconstrucción de acciones.

## Herramientas recomendadas (DriveFS)

* **DriveFS Sleuth**: extrae **cuentas**, catálogos de elementos y **hash MD5**; salida **CSV/HTML** para explorar jerarquías. También analiza **root\_preference\_sqlite.db** (historial de **soportes extraíbles** monitorizados por la copia de seguridad).
* **gMetaDataParse / gMetadataParse**: automatiza el parseo de `metadata_sqlite_db` (+ unión con `item_properties`) y mapea contra `content_cache`; genera **CSV/JSON** y una **GUI** de exploración.

## Procedimiento sugerido de análisis (checklist)

1. **Confirmar montaje y cuenta**
	- Registro: `…\Google\DriveFS\Share` → **SyncTargets** (letra y account\_id). Documentar **letra** para correlacionar con LNK/Jump Lists/RecentDocs.
2. **Enumerar metadatos**
	- Extraer `metadata_sqlite_db` (+ `mirror_metadata_sqlite_db` si existe). Tablas **items** y **item\_properties** para: propiedad, estado (**trashed**), rutas, tiempos, **IDs** de nube.
3. **Reconstruir contenido efectivo**
	- Usar **gMetaDataParse** para cruzar DB ↔ `content_cache` y listar qué **existe en caché** (posibles copias de **solo nube**).
4. **Hashing y búsqueda por IOC**
	- Con DriveFS Sleuth, obtener MD5 por elemento y priorizar búsqueda por hash cuando no se dispone del fichero local.
5. **Auditoría Workspace (si aplica)**
	- Exportar eventos de Drive; filtrar por usuario, acción (delete/download/share), nombre parcial y cruzar con IDs de items. Tener en cuenta redundancias y límites de la interfaz; considerar exportación a CSV/DB para filtros avanzados.
6. **Correlación SO/Navegador**
	- LNK, Jump Lists, MRUs, Papelera local y búsqueda en logs del usuario de “My Drive” y letra de unidad asignada a DriveFS; útil para probar existencia histórica aunque ya no esté en la ruta.

## Tabla rápida “Qué buscar / Dónde / Para qué”

| Qué                                 | Dónde                                                              | Para qué                                                                                                             |
| ----------------------------------- | ------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------- |
| Letra de unidad y cuenta DriveFS    | Registro: `NTUSER\Software\Google\DriveFS\Share` → **SyncTargets** | Correlacionar con accesos (LNK, Jump Lists, RecentDocs) y ubicar “Mi unidad” virtual.                                |
| **metadata\_sqlite\_db** (+ mirror) | `%UserProfile%\AppData\Local\Google\DriveFS\<id>\`                 | Inventario global (offline/solo nube/Compartidos/Papelera), propietario, tiempos, **IDs**.                           |
| **content\_cache**                  | `%UserProfile%\AppData\Local\Google\DriveFS\<id>\content_cache`    | Recuperar copias locales (renombradas), incluyendo posibles **solo nube**. Verificación por **cabecera**/**hash**.   |
| **DriveFS Sleuth**                  | (sobre metadata/caché)                                             | Exportar CSV/HTML y **hashes MD5** para IOC y triage a gran escala.                                                  |
| **gMetaDataParse**                  | (metadata\_sqlite\_db + content\_cache)                            | Automatizar mapeo DB↔caché y visualizar jerarquía (GUI). Salidas CSV/JSON.                                           |
| **Workspace Audit**                 | Consola admin / export                                             | Trazar **descargas**, **eliminaciones**, **compartidos**, etc.; ojo con **redundancias** y límites de la UI.         |
| Tiempos (creación/mod/acceso)       | Tabla del módulo                                                   | En Drive Desktop, **creación** y **acceso** se conservan; base para línea temporal.                                  |

## Notas y “gotchas”
- El FS de DriveFS es **efímero** (solo visible en vivo con sesión iniciada). No asumir accesibilidad desde imágenes frías; apoyarse en **caché** y **DBs**.
- **content\_cache**: los nombres no tienen extensión; identificar por **cabecera** o por **hash** conocido.
- En auditoría de Workspace, “**Descarga**” puede representar **visualización**; verificar contexto, IPs y eventos correlativos.
- Para atribución: el **id** de `items` ayuda a unir **DB local**, **registros Workspace** y **URLs** halladas en navegador.
